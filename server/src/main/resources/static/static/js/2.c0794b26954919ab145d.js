webpackJsonp([2],{"/wZ4":function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=s("mvHQ"),a=s.n(e),l=s("bOdI"),r=s.n(l),o={name:"quoteDetail",data:function(){var t;return t={id:this.$route.query.id,templateId:this.$route.query.templateId,model:[],dataList:[],totalOld:0,totalNew:0,ratio:0,indecFlag:0,changgeStatus:!1,projectName:"",editModel:!1,isShowNew:!1,QuoteModel:!1,quoteProjectName:"",qouteList:[],qouteId:"",projectList:{}},r()(t,"isShowNew",!1),r()(t,"totalOld",0),r()(t,"totalNew",0),r()(t,"materialList",[]),r()(t,"supplierList",[]),r()(t,"qouteModelList",[]),t},components:{},methods:{focus:function(t,i){this.changgeStatus=!0,this.indecFlag=t,this.ratio=i},blur:function(t,i){this.dataList[t].ratio=i,this.dataList[t].quoteNum=this.dataList[t].count*this.dataList[t].price,this.dataList[t].factNum=this.dataList[t].count*this.dataList[t].price*i;var s=0,e=0;for(var a in this.dataList)s+=Number(this.dataList[a].qouteNum),e+=Number(this.dataList[a].factNum);this.totalOld=s,this.totalNew=e},edit:function(){this.editModel=!0},editCancel:function(){this.changgeStatus&&(this.dataList[this.indecFlag].ratio=this.ratio),this.editModel=!1,this.changgeStatus=!1},editConfirm:function(){var t=this;this.$axios({method:"post",url:"quote/update",data:this.qs.stringify({id:this.id,projectName:this.projectName,totalOld:this.totalOld,totalNew:this.totalNew,contains:a()(this.dataList)})}).then(function(i){"200"==i.data.code?(t.$Message.success(i.data.msg),t.loadData(),t.editModel=!1,t.ratio=0,t.changgeStatus=!1):t.$Message.error(i.data.msg)})},getModel:function(){var t=this;this.$axios({method:"get",url:"template/detail",params:{id:this.templateId}}).then(function(i){"200"==i.data.code?t.model=JSON.parse(i.data.data.contains):t.$Message.error(i.data.msg)})},loadData:function(){var t=this;this.$axios({method:"get",url:"quote/detail",params:{id:this.id}}).then(function(i){if("200"==i.data.code){t.dataList=JSON.parse(i.data.data.contains),t.totalOld=i.data.data.totalOld,t.totalNew=i.data.data.totalNew,t.projectName=i.data.data.projectName;var s=[],e=[],a=[];for(var l in t.dataList)s.push(t.dataList[l].meterial),e.push(t.dataList[l].count),a.push(t.dataList[l].price);t.loadEcharts1(s,e),t.loadEcharts2(s,a)}else t.$Message.error(i.data.msg)})},loadEcharts1:function(t,i){this.$echarts.init(document.getElementById("myChart1")).setOption({title:{text:"项目材料数量统计图"},tooltip:{},xAxis:{data:t},yAxis:{},series:[{name:"数量",type:"bar",data:i}]})},loadEcharts2:function(t,i){for(var s=this.$echarts.init(document.getElementById("myChart2")),e=[],a=t.length,l=0;l<a;l++){var r={};r.value=i[l],r.name=t[l],e.push(r)}console.log(e),s.setOption({title:{text:"项目各材料报价比例",left:"right"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:t},series:[{name:"报价占比",type:"pie",radius:"55%",center:["50%","60%"],data:e,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})},toQuote:function(){this.qouteModelList=[],this.quoteProjectName="",this.projectList={},this.QuoteModel=!0,this.isShowNew=!0,this.qouteId=this.id,this.qouteList=this.model;var t={};for(var i in this.qouteList)"meterial"==this.qouteList[i].value?t.meterial="":"supplier"==this.qouteList[i].value?t.supplier="":"price"==this.qouteList[i].value?t.price="":"count"==this.qouteList[i].value?t.count="":"supplierUser"==this.qouteList[i].value?t.supplierUser="":"supplierPhone"==this.qouteList[i].value?t.supplierPhone="":"unit"==this.qouteList[i].value?t.unit="":"address"==this.qouteList[i].value&&(t.address="");t.ratio=1,this.projectList=t,console.log(this.projectList)},qouteAdd:function(){for(var t in this.projectList)if(!this.projectList[t])return void this.$Message.error({content:" 每一项加入时都不能为空",duration:2e3});this.isShowNew=!1;var i=this.projectList;i.qouteNum=i.price*i.count,i.factNum=i.price*i.count*i.ratio,this.qouteModelList.push(i),this.totalOld=this.totalOld+i.qouteNum,this.totalNew=this.totalNew+i.factNum,this.projectList={}},quoteCancel:function(){this.QuoteModel=!1,this.qouteId="",this.qouteList=[],this.projectList={},this.totalOld=0,this.totalNew=0,this.qouteModelList=[]},quoteConfirm:function(){var t=this;if(this.quoteProjectName)if(this.qouteModelList.length<=0)this.$Message.error({content:"报价内容不能为空",duration:2e3});else if(this.totalOld<=0)this.$Message.error({content:"报价总计不能0",duration:2e3});else if(this.totalNew<=0)this.$Message.error({content:"实际报价总计不能0",duration:2e3});else{this.$axios({method:"post",url:"quote/save",data:this.qs.stringify({templateId:this.templateId,projectName:this.quoteProjectName,totalOld:this.totalOld,totalNew:this.totalNew,contains:a()(this.qouteModelList)})}).then(function(i){"200"==i.data.code?(t.$Message.success(i.data.msg),t.QuoteModel=!1,t.qouteId="",t.qouteList=[],t.totalOld=0,t.totalNew=0):t.$Message.error(i.data.msg)})}else this.$Message.error({content:"项目名不能为空",duration:2e3})},loadMaterial:function(){var t=this;this.$axios({method:"get",url:"material/list"}).then(function(i){"200"==i.data.code?t.materialList=i.data.data:t.$Message.error(i.data.msg)})},openSupplier:function(){this.projectList.meterial||this.$Message.error("请先选择物料名称！")},loadSupplier:function(t){var i=this,s="";for(var e in this.materialList)t==this.materialList[e].materialName&&(s=this.materialList[e].materialName);if(s){this.supplierList=[];this.$axios({method:"get",url:"material/getSuppListByMaterialName",params:{materialName:s}}).then(function(t){"200"==t.data.code?i.supplierList=t.data.data:i.$Message.error(t.data.msg)})}},toAddNewName:function(){this.isShowNew=!0,this.projectList={};var t={};for(var i in this.qouteList)"meterial"==this.qouteList[i].value?t.meterial="":"supplier"==this.qouteList[i].value?t.supplier="":"price"==this.qouteList[i].value?t.price="":"count"==this.qouteList[i].value?t.count="":"supplierUser"==this.qouteList[i].value?t.supplierUser="":"supplierPhone"==this.qouteList[i].value?t.supplierPhone="":"unit"==this.qouteList[i].value?t.unit="":"address"==this.qouteList[i].value&&(t.address="");t.ratio=1,this.projectList=t}},mounted:function(){this.loadData(),this.getModel(),this.loadMaterial()}},d={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"titleWrap"},[e("div",{staticClass:"title"},[t._v("\n      报价清单：\n    ")]),t._v(" "),e("div",{staticClass:"add putHover",on:{click:t.toQuote}},[t._v("\n      用此模板去报价"),e("img",{attrs:{src:s("QBcd"),alt:""}})])]),t._v(" "),e("div",{staticClass:"listWrap shadow"},[e("ul",{staticClass:"list"},[e("li",{staticClass:"li_div font_blod"},[t._v(t._s(t.projectName)+"项目报价清单")]),t._v(" "),e("li",{staticClass:"putHover",staticStyle:{color:"blue",width:"100px"},on:{click:function(i){return t.edit()}}},[t._v("编辑系数")])]),t._v(" "),e("ul",{staticClass:"list"},[t._l(t.model,function(i,s){return e("li",{key:s,staticClass:"li_div right_border"},[t._v(t._s(i.name))])}),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("报价小计")]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("系数")]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("实际小计")])],2),t._v(" "),t._l(t.dataList,function(i,s){return e("ul",{key:s,staticClass:"list"},[e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.meterial))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplier))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.price))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.count))])]),t._v(" "),null!=i.supplierUser?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplierUser))])]):t._e(),t._v(" "),null!=i.supplierPhone?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplierPhone))])]):t._e(),t._v(" "),null!=i.unit?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.unit))])]):t._e(),t._v(" "),null!=i.address?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.address))])]):t._e(),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v(t._s(i.qouteNum))]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.ratio))])]),t._v(" "),i?e("li",{staticClass:"li_div right_border"},[t._v(t._s(i.factNum))]):t._e()])}),t._v(" "),e("ul",{staticClass:"list"},[e("li",{staticClass:"li_div right_border"},[t._v("报价合计")]),t._v(" "),e("li",{staticClass:"total right_border"},[t._v(t._s(t.totalOld))]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("实际合计")]),t._v(" "),e("li",{staticClass:"total "},[t._v(t._s(t.totalNew))])])],2),t._v(" "),e("div",{staticClass:"echartsWrap"},[e("div",{staticClass:"charts shadow"},[e("div",{style:{width:"300px",height:"300px"},attrs:{id:"myChart1"}})]),t._v(" "),e("div",{staticClass:"charts shadow"},[e("div",{style:{width:"300px",height:"300px"},attrs:{id:"myChart2"}})])]),t._v(" "),e("div",{staticClass:"modelWrap"},[e("Modal",{staticClass:"addModel",attrs:{closable:!1,"mask-closable":!1,width:"1100"},model:{value:t.editModel,callback:function(i){t.editModel=i},expression:"editModel"}},[e("p",{staticClass:"modelTitle",attrs:{slot:"header"},slot:"header"},[t._v("\n          填写报价信息\n      ")]),t._v(" "),e("div",{staticClass:"modelContent"},[e("div",{staticClass:"type_content"},[e("span",{staticClass:"input_name"},[t._v("项目名称：")]),t._v(" "),e("Input",{staticClass:"model_input",attrs:{type:"text",placeholder:"请输入项目名称",maxlength:9},model:{value:t.projectName,callback:function(i){t.projectName=i},expression:"projectName"}})],1),t._v(" "),e("div",{staticClass:"listWrap shadow"},[e("ul",{staticClass:"list"},[t._l(t.model,function(i,s){return e("li",{key:s,staticClass:"li_div right_border"},[t._v(t._s(i.name))])}),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("报价小计")]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("系数")]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("实际小计")])],2),t._v(" "),t._l(t.dataList,function(i,s){return e("ul",{key:s,staticClass:"list"},[e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.meterial))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplier))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.price))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.count))])]),t._v(" "),null!=i.supplierUser?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplierUser))])]):t._e(),t._v(" "),null!=i.supplierPhone?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplierPhone))])]):t._e(),t._v(" "),null!=i.unit?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.unit))])]):t._e(),t._v(" "),null!=i.address?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.address))])]):t._e(),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v(t._s(i.qouteNum))]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入系数",type:"number"},on:{"on-focus":function(e){return t.focus(s,i.ratio)},"on-blur":function(e){return t.blur(s,i.ratio)}},model:{value:i.ratio,callback:function(s){t.$set(i,"ratio",s)},expression:"item.ratio"}})],1),t._v(" "),i?e("li",{staticClass:"li_div right_border"},[t._v(t._s(i.factNum))]):t._e()])}),t._v(" "),e("ul",{staticClass:"list"},[e("li",{staticClass:"li_div right_border"},[t._v("报价合计")]),t._v(" "),e("li",{staticClass:"total right_border"},[t._v(t._s(t.totalOld))]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("实际合计")]),t._v(" "),e("li",{staticClass:"total "},[t._v(t._s(t.totalNew))])])],2)]),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("div",{staticClass:"modelBtnWraP"},[e("span",{staticClass:"cancel",on:{click:t.editCancel}},[t._v("取消")]),t._v(" "),e("span",{staticClass:"confirm",on:{click:t.editConfirm}},[t._v("确认")])])])]),t._v(" "),e("Modal",{staticClass:"addModel",attrs:{closable:!1,"mask-closable":!1,width:"1100"},model:{value:t.QuoteModel,callback:function(i){t.QuoteModel=i},expression:"QuoteModel"}},[e("p",{staticClass:"modelTitle",attrs:{slot:"header"},slot:"header"},[t._v("\n          填写报价信息\n      ")]),t._v(" "),e("div",{staticClass:"modelContent"},[e("div",{staticClass:"type_content"},[e("span",{staticClass:"input_name"},[t._v("项目名称：")]),t._v(" "),e("Input",{staticClass:"model_input",attrs:{type:"text",placeholder:"请输入项目名称",maxlength:9},model:{value:t.quoteProjectName,callback:function(i){t.quoteProjectName=i},expression:"quoteProjectName"}})],1),t._v(" "),e("div",{staticClass:"listWrap shadow"},[e("ul",{staticClass:"list"},[t._l(t.qouteList,function(i,s){return e("li",{key:s,staticClass:"li_div right_border"},[t._v(t._s(i.name))])}),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("报价小计")]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("系数")]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("实际小计")]),t._v(" "),e("li",{staticClass:"li_div "},[t._v("状态")])],2),t._v(" "),t._l(t.qouteModelList,function(i,s){return e("ul",{key:s,staticClass:"list"},[e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.meterial))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplier))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.price))])]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.count))])]),t._v(" "),null!=i.supplierUser?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplierUser))])]):t._e(),t._v(" "),null!=i.supplierPhone?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.supplierPhone))])]):t._e(),t._v(" "),null!=i.unit?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.unit))])]):t._e(),t._v(" "),null!=i.address?e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.address))])]):t._e(),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v(t._s(i.qouteNum))]),t._v(" "),e("li",{staticClass:"li_div right_border"},[e("span",[t._v(t._s(i.ratio))])]),t._v(" "),i?e("li",{staticClass:"li_div right_border"},[t._v(t._s(i.factNum))]):t._e(),t._v(" "),e("li",{staticClass:"li_div "},[e("span",[t._v("已加入")])])])}),t._v(" "),t.isShowNew?e("ul",{staticClass:"list"},[t.projectList?e("li",{staticClass:"li_div right_border"},[e("Select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择物料名称",size:"small"},on:{"on-change":function(i){return t.loadSupplier(t.projectList.meterial)}},model:{value:t.projectList.meterial,callback:function(i){t.$set(t.projectList,"meterial",i)},expression:"projectList.meterial"}},t._l(t.materialList,function(i){return e("Option",{key:i.materialId,attrs:{value:i.materialName}},[t._v(t._s(i.materialName))])}),1)],1):t._e(),t._v(" "),t.projectList?e("li",{staticClass:"li_div right_border"},[e("Select",{staticStyle:{width:"90px"},attrs:{placeholder:"请选择供应商",size:"small"},on:{"on-open-change":t.openSupplier},model:{value:t.projectList.supplier,callback:function(i){t.$set(t.projectList,"supplier",i)},expression:"projectList.supplier"}},t._l(t.supplierList,function(i){return e("Option",{key:i.supplierId,attrs:{value:i.supplierName}},[t._v(t._s(i.supplierName))])}),1)],1):t._e(),t._v(" "),t.projectList?e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入价格",type:"number"},model:{value:t.projectList.price,callback:function(i){t.$set(t.projectList,"price",i)},expression:"projectList.price"}})],1):t._e(),t._v(" "),t.projectList?e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入数量",type:"number"},model:{value:t.projectList.count,callback:function(i){t.$set(t.projectList,"count",i)},expression:"projectList.count"}})],1):t._e(),t._v(" "),t.projectList&&null!=t.projectList.supplierUser?e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入联系人"},model:{value:t.projectList.supplierUser,callback:function(i){t.$set(t.projectList,"supplierUser",i)},expression:"projectList.supplierUser"}})],1):t._e(),t._v(" "),t.projectList&&null!=t.projectList.supplierPhone?e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入联系方式"},model:{value:t.projectList.supplierPhone,callback:function(i){t.$set(t.projectList,"supplierPhone",i)},expression:"projectList.supplierPhone"}})],1):t._e(),t._v(" "),t.projectList&&null!=t.projectList.unit?e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入计量单位"},model:{value:t.projectList.unit,callback:function(i){t.$set(t.projectList,"unit",i)},expression:"projectList.unit"}})],1):t._e(),t._v(" "),t.projectList&&null!=t.projectList.address?e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入详细地址"},model:{value:t.projectList.address,callback:function(i){t.$set(t.projectList,"address",i)},expression:"projectList.address"}})],1):t._e(),t._v(" "),t.projectList?e("li",{staticClass:"li_div right_border"},[t._v(t._s(t.projectList.price*t.projectList.count))]):t._e(),t._v(" "),t.projectList?e("li",{staticClass:"li_div right_border"},[e("Input",{staticClass:"addName_input",attrs:{placeholder:"请输入系数",type:"number"},model:{value:t.projectList.ratio,callback:function(i){t.$set(t.projectList,"ratio",i)},expression:"projectList.ratio"}})],1):t._e(),t._v(" "),t.projectList?e("li",{staticClass:"li_div right_border"},[t._v(t._s(t.projectList.price*t.projectList.count*t.projectList.ratio?t.projectList.price*t.projectList.count*t.projectList.ratio:0))]):t._e(),t._v(" "),e("li",{staticClass:"li_div "},[e("span",{staticClass:"putHover",staticStyle:{color:"blue"},on:{click:function(i){return t.qouteAdd()}}},[t._v("加入")])])]):t._e(),t._v(" "),e("ul",{staticClass:"list"},[e("img",{staticClass:"putHover",attrs:{src:s("QBcd"),alt:""},on:{click:t.toAddNewName}})]),t._v(" "),e("ul",{staticClass:"list"},[e("li",{staticClass:"li_div right_border"},[t._v("报价合计")]),t._v(" "),e("li",{staticClass:"total right_border"},[t._v(t._s(t.totalOld))]),t._v(" "),e("li",{staticClass:"li_div right_border"},[t._v("实际合计")]),t._v(" "),e("li",{staticClass:"total "},[t._v(t._s(t.totalNew))])])],2)]),t._v(" "),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("div",{staticClass:"modelBtnWraP"},[e("span",{staticClass:"cancel",on:{click:t.quoteCancel}},[t._v("取消")]),t._v(" "),e("span",{staticClass:"confirm",on:{click:t.quoteConfirm}},[t._v("确认")])])])])],1)])},staticRenderFns:[]};var c=s("VU/8")(o,d,!1,function(t){s("kP4A")},"data-v-326cab0c",null);i.default=c.exports},"9bBU":function(t,i,s){s("mClu");var e=s("FeBl").Object;t.exports=function(t,i,s){return e.defineProperty(t,i,s)}},C4MV:function(t,i,s){t.exports={default:s("9bBU"),__esModule:!0}},bOdI:function(t,i,s){"use strict";i.__esModule=!0;var e,a=s("C4MV"),l=(e=a)&&e.__esModule?e:{default:e};i.default=function(t,i,s){return i in t?(0,l.default)(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t}},kP4A:function(t,i){},mClu:function(t,i,s){var e=s("kM2E");e(e.S+e.F*!s("+E39"),"Object",{defineProperty:s("evD5").f})},mvHQ:function(t,i,s){t.exports={default:s("qkKv"),__esModule:!0}},qkKv:function(t,i,s){var e=s("FeBl"),a=e.JSON||(e.JSON={stringify:JSON.stringify});t.exports=function(t){return a.stringify.apply(a,arguments)}}});
//# sourceMappingURL=2.c0794b26954919ab145d.js.map