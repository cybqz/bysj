<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cyb.engcostms.dao.EnquiryMapper">
    
    <sql id="newestListSQL">
        left join material m on e.material_id = m.material_id
        where e.create_date_time in (
            select max(create_date_time) from enquiry group by belong_id
        )
        <if test="materialName != null">
            and m.material_name like concat('%',#{materialName}, '%')
        </if>
    </sql>

    <!-- 根据条件查询最新记录总数 -->
    <select id="newestListCount" resultType="java.lang.Integer">
        select count(*) from enquiry e
        <include refid="newestListSQL"/>
    </select>
    
    <!-- 根据条件查询最新记录 -->
    <select id="newestList" resultMap="baseResultMap">
        select e.* from enquiry e
        <include refid="newestListSQL"/>
        order by e.material_id desc
        <if test="pagination.pageIndex != null and pagination.limit">
            limit #{pagination.pageIndex, jdbcType = INTEGER}, #{pagination.limit, jdbcType = INTEGER}
        </if>
    </select>
</mapper>
